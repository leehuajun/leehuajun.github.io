<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|JetBrains Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="LeeHuaJun&#39;s Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LeeHuaJun&#39;s Notes">
<meta property="article:author" content="LeeHuaJun">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>LeeHuaJun's Notes</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LeeHuaJun's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">many a little makes a mickle</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/07/mac-delete-default-inputlanguage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeeHuaJun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/leehuajun/imgbed/raw/master/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeHuaJun's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/07/mac-delete-default-inputlanguage/" itemprop="url">Mac 删除默认的英文输入法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-07T20:57:18+08:00">
                2020-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mac/" itemprop="url" rel="index">
                    <span itemprop="name">mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、关闭SIP（系统完整性保护）安全设置。"><a href="#一、关闭SIP（系统完整性保护）安全设置。" class="headerlink" title="一、关闭SIP（系统完整性保护）安全设置。"></a>一、关闭SIP（系统完整性保护）安全设置。</h2><p>1、重启 Mac，按住 Command+R 键直到 Apple logo 出现，进入 Recovery Mode</p>
<p>2、点击左数第三个 Utilities(实用工具) &gt; Terminal（终端）</p>
<p>3、在 Terminal （终端）中输入 csrutil status  查询 SIP 状态，disable 为关闭，enable 为开启。</p>
<p>4、关闭 SIP安全设置：输入 csrutil disable ，回车</p>
<p>5、重启 Mac，设置生效</p>
<blockquote>
<p>这样 SIP 安全设置就已经被关闭，如果想重新开启SIP安全设置，重复上面步骤，在第三步中将命令更换为 csrutil enable。</p>
</blockquote>
<h2 id="二、删除系统自带输入法"><a href="#二、删除系统自带输入法" class="headerlink" title="二、删除系统自带输入法"></a>二、删除系统自带输入法</h2><p>1.、将输入法切换为系统默认输入法。</p>
<p>2、安装Xcode或者PlistEdit Pro等 list 编辑软件</p>
<p>3、Finder 前往路径 ~/Library/Preferences/com.apple.HIToolbox.plist ，用安全的软件打开 com.apple.HIToolbox.plist 文件，打开 Root 节点。</p>
<p>4、选中“Root”—“AppleEnabledInputSources”， 接着会跳出名为“0、1、2、3、4、5、6”的文件夹，逐个翻阅各个文件夹，待找到出现“ABC”关键字样的文件夹时，删除整个以数字命名的文件，保存，关闭。</p>
<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607205815.png" alt="image-20200517195935233"></p>
<p>5、重启Mac，设置生效</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/07/mysql-setup-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeeHuaJun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/leehuajun/imgbed/raw/master/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeHuaJun's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/07/mysql-setup-mac/" itemprop="url">Mac下安装MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-07T20:50:47+08:00">
                2020-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、下载MySQL（5-7-x）"><a href="#1、下载MySQL（5-7-x）" class="headerlink" title="1、下载MySQL（5.7.x）"></a>1、下载MySQL（5.7.x）</h3><h3 id="2、安装MySQL（略）"><a href="#2、安装MySQL（略）" class="headerlink" title="2、安装MySQL（略）"></a>2、安装MySQL（略）</h3><h3 id="3、修改密码"><a href="#3、修改密码" class="headerlink" title="3、修改密码"></a>3、修改密码</h3><h4 id="1）打开终端，为Path路径附加MySQL的bin目录"><a href="#1）打开终端，为Path路径附加MySQL的bin目录" class="headerlink" title="1）打开终端，为Path路径附加MySQL的bin目录"></a>1）打开终端，为Path路径附加MySQL的bin目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH="$PATH":/usr/local/mysql/bin</span><br></pre></td></tr></table></figure>

<h4 id="2）然后通过以下命令登陆MySQL（密码就是前面自动生成的临时密码）"><a href="#2）然后通过以下命令登陆MySQL（密码就是前面自动生成的临时密码）" class="headerlink" title="2）然后通过以下命令登陆MySQL（密码就是前面自动生成的临时密码）"></a>2）然后通过以下命令登陆MySQL（密码就是前面自动生成的临时密码）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

<h4 id="3）登陆成功，但是运行命令的时候会报错，提示我们需要重设密码。"><a href="#3）登陆成功，但是运行命令的时候会报错，提示我们需要重设密码。" class="headerlink" title="3）登陆成功，但是运行命令的时候会报错，提示我们需要重设密码。"></a>3）登陆成功，但是运行命令的时候会报错，提示我们需要重设密码。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line"></span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br></pre></td></tr></table></figure>

<h4 id="4）-修改密码，新密码为Abc-amp-20202020"><a href="#4）-修改密码，新密码为Abc-amp-20202020" class="headerlink" title="4） 修改密码，新密码为Abc&amp;20202020"></a>4） 修改密码，新密码为<code>Abc&amp;20202020</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set PASSWORD&#x3D;PASSWORD(&#39;Abc&amp;20202020&#39;);</span><br></pre></td></tr></table></figure>

<h4 id="5）再次执行"><a href="#5）再次执行" class="headerlink" title="5）再次执行"></a>5）再次执行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>

<p>就正常了。</p>
<h3 id="4、修改默认字符集"><a href="#4、修改默认字符集" class="headerlink" title="4、修改默认字符集"></a>4、修改默认字符集</h3><h4 id="1）检查默认安装的mysql的字符集"><a href="#1）检查默认安装的mysql的字符集" class="headerlink" title="1）检查默认安装的mysql的字符集"></a>1）检查默认安装的mysql的字符集</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%char%&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607163813.png" alt="image-20200517181851542"></p>
<p><code>character_set_database</code>和<code>character_set_server</code>依然是<code>latin1</code>的字符集，也就是说mysql后续创建的表都是<code>latin1</code>字符集的，不是utf8，会造成一些麻烦。所以有必要修改my.cnf，在修改my.cnf之前一定要关闭mysql进程，不然会遇到mysql的sock不能连接的问题。</p>
<h4 id="2）修改-新建-my-cnf"><a href="#2）修改-新建-my-cnf" class="headerlink" title="2）修改/新建 my.cnf"></a>2）修改/新建 <code>my.cnf</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/my.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br></pre></td></tr></table></figure>

<h4 id="3）检查结果："><a href="#3）检查结果：" class="headerlink" title="3）检查结果："></a>3）检查结果：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%char%&#39;;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/07/zk-mvvm-02-viewmodel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeeHuaJun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/leehuajun/imgbed/raw/master/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeHuaJun's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/07/zk-mvvm-02-viewmodel/" itemprop="url">ZK-MVVM-02-ViewModel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-07T20:12:53+08:00">
                2020-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zk/" itemprop="url" rel="index">
                    <span itemprop="name">zk</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h1><h2 id="ViewModel是什么"><a href="#ViewModel是什么" class="headerlink" title="ViewModel是什么"></a>ViewModel是什么</h2><p>ViewModel是Model的抽象。 它从一个或多个Model类中提取要在View上显示的必要数据。 这些数据通过getter和setter方法（如JavaBean的属性）公开。</p>
<p>ViewModel也是视图的模型。 它包含视图的状态（例如，选择，启用状态），该状态在用户交互过程中可能会发生变化。 例如，如果用户选择列表框的项目时启用了按钮。 ViewModel应存储按钮的启用状态的状态，并实现启用按钮的逻辑。</p>
<p>尽管ViewModel存储视图的状态，但它不包含对UI组件的引用。 它不能直接访问任何UI组件。 因此，有一种数据绑定机制可以在View和ViewModel之间同步数据。 开发人员定义了View（UI组件）和ViewModel之间的绑定关系后，数据绑定机制将自动同步数据。 这使得ViewModel和View松散耦合。</p>
<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607161843.png" alt="image-20200605154101145"></p>
<p>ViewModel就像MVC中的Controller一样，因此数据绑定机制将事件转发给ViewModel的处理程序。 处理程序是具有特定Java注解的ViewModel方法。 我们称这种方法为ViewModel的Command。 这些方法通常操纵ViewModel的数据，例如删除项目。 数据绑定机制还支持使用ViewModel的命令绑定UI组件的事件。 触发组件的事件将触发绑定命令的执行，并调用带注解的方法。</p>
<p>在执行命令期间，通常会更改ViewModel的数据。 开发人员应指定哪些属性更改将通过Java注解进行通知。</p>
<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607161848.png" alt="image-20200605154116873"></p>
<p>UI有时必须以与模型中原始格式不同的格式显示数据。 转换逻辑应在ViewModel中实现，否则开发人员可以采用可重用性更高的元素转换器，我们将在后面的部分中进行讨论。</p>
<p>在将数据保存到ViewModel之前，还将执行验证。 如果验证失败，则数据将不会保存到ViewModel。</p>
<h3 id="ViewModel-with-Annotation"><a href="#ViewModel-with-Annotation" class="headerlink" title="ViewModel with Annotation"></a>ViewModel with Annotation</h3><p>在ZK中，ViewModel可以只是一个POJO，它对View的视觉元素一无所知，这意味着它不应该包含对UI组件的任何引用。 数据绑定机制处理View和ViewModel之间的通信和同步。 开发人员必须使用ZK提供的Java注解指定ViewModel的命令和数据依赖性，然后数据绑定机制将知道如何与ViewModel进行交互。</p>
<p>创建ViewModel类似于创建POJO，并且通过setter和getter方法公开其属性，例如JavaBean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotifyChange</span>(&#123;<span class="string">"selected"</span>, <span class="string">"orders"</span>&#125;)</span><br><span class="line">    <span class="meta">@Command</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//manipulate data</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们将在 <a href="#_bookmark10">ViewModel/Notification</a> 中详细描述上述注解</p>
<h3 id="在ZUL中引用ViewModel"><a href="#在ZUL中引用ViewModel" class="headerlink" title="在ZUL中引用ViewModel"></a>在ZUL中引用ViewModel</h3><p>我们可以通过设置ZK UI组件的viewModel属性将其绑定到ViewModel，然后该组件成为ViewModel的Root View组件。 此根视图组件的所有子组件都可以访问相同的ViewModel及其属性。 要绑定ViewModel，我们必须应用一个名为<code>org.zkoss.bind.BindComposer</code>的组合器，它将为ViewModel创建一个绑定器并实例化ViewModel的类。 然后使用ZK Bind注解设置viewModel属性，在@id中设置ViewModel的ID，在@init中设置ViewModel的全限定类名。 该 id 用于引用ViewModel的属性，例如 vm.name，而完全限定的类名用于实例化ViewModel对象本身。 我们将在“数据绑定”的小节中详细解释ZK Bind注解语法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">window</span> <span class="attr">apply</span>=<span class="string">"org.zkoss.bind.BindComposer"</span> <span class="attr">viewModel</span>=<span class="string">"@id('vm') @init('foo.MyViewModel')"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">value</span>=<span class="string">"@bind(vm.name)"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">"@command('newOrder')"</span> <span class="attr">label</span>=<span class="string">"New Order"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="初始化（Initialization）"><a href="#初始化（Initialization）" class="headerlink" title="初始化（Initialization）"></a>初始化（Initialization）</h2><h3 id="初始化方法"><a href="#初始化方法" class="headerlink" title="初始化方法"></a>初始化方法</h3><p>binder负责创建和初始化ViewModel实例。 如果要在ViewModel中执行自己的初始化，则可以通过使用@Init注解方法来声明自己的初始方法。 初始化ViewModel时，binder将调用此方法。 每个ViewModel<code>只能有一个初始方法</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Init</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//initialization code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该注解具有一个名为“超类”的属性，如果将其设置为“ true”，则绑定器将查找ViewModel父类的初始方法，如果存在，则首先调用它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Init</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parentInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//initialization code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChildViewModel</span> <span class="keyword">extends</span> <span class="title">ParentViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* ParentViewModel's initial method is invoked first then ChildViewModel's. */</span></span><br><span class="line">    <span class="meta">@Init</span>(superclass = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">childInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//initialization code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>请注意，子类的初始方法不应覆盖父类的初始方法，否则父类的初始方法将不会被调用，而子类的初始方法将被<code>调用两次</code>。</p>
</blockquote>
<h3 id="Apply-on-Class"><a href="#Apply-on-Class" class="headerlink" title="Apply on Class"></a>Apply on Class</h3><blockquote>
<p>Since 6.0.1</p>
</blockquote>
<p>如果super具有初始化方法，但其ChildViewModel没有，则可以在ChildViewModel上添加@Init（superclass = true）以使用super的初始化方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Init</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Init</span>(superclass = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChildViewModel</span> <span class="keyword">extends</span> <span class="title">ParentViewModel</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始方法可以通过在其参数上添加注解来检索各种上下文对象，请参阅 <a href="#_bookmark32">Advanced/Parameters</a></p>
<h2 id="数据与集合"><a href="#数据与集合" class="headerlink" title="数据与集合"></a>数据与集合</h2><h3 id="暴露ViewModel的属性"><a href="#暴露ViewModel的属性" class="headerlink" title="暴露ViewModel的属性"></a>暴露ViewModel的属性</h3><p>像JavaBean一样，ViewModel通过getter和setter方法公开其属性。 View（ZUL）希望通过数据绑定检索的任何属性都应具有相应的getter方法。 方法的返回类型可以是简单类型（int，boolean …）或JavaBean。 如果UI组件需要将其属性值（通常是用户输入）保存回ViewModel的属性，则ViewModel应该提供相应的setter方法。 因此，通过setter和getter可以使用数据绑定机制来更改View和ViewModel的数据。</p>
<h3 id="属性是简单类型"><a href="#属性是简单类型" class="headerlink" title="属性是简单类型"></a>属性是简单类型</h3><h4 id="简单类型的属性"><a href="#简单类型的属性" class="headerlink" title="简单类型的属性"></a>简单类型的属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimitiveViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.index = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用PrimitiveViewModel的zul"><a href="#使用PrimitiveViewModel的zul" class="headerlink" title="使用PrimitiveViewModel的zul"></a>使用PrimitiveViewModel的zul</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">window</span> <span class="attr">apply</span>=<span class="string">"org.zkoss.bind.BindComposer"</span> <span class="attr">viewModel</span>=<span class="string">"@id('vm') @init('foo.PrimitiveViewModel')"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intbox</span> <span class="attr">value</span>=<span class="string">"@bind(vm.index)"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">doublebox</span> <span class="attr">value</span>=<span class="string">"@bind(vm.price)"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- other components --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>@id(&#39;vm&#39;)</code>设置ViewModel名称，然后我们可以使用vm在以下组件中引用ViewModel的属性(第一行)</p>
</blockquote>
<h3 id="属性是Object或者JavaBean"><a href="#属性是Object或者JavaBean" class="headerlink" title="属性是Object或者JavaBean"></a>属性是Object或者JavaBean</h3><p>如果属性是JavaBean，则也可以通过EL表达式访问该JavaBean的属性</p>
<h4 id="Object类型属性"><a href="#Object类型属性" class="headerlink" title="Object类型属性"></a>Object类型属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">		<span class="comment">//gettter &amp; setter</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectViewModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer index;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//JavaBean</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(Integer index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.index = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用ObjectViewModel的zul"><a href="#使用ObjectViewModel的zul" class="headerlink" title="使用ObjectViewModel的zul"></a>使用ObjectViewModel的zul</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intbox</span> <span class="attr">value</span>=<span class="string">"@bind(vm.index)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">textbox</span> <span class="attr">value</span>=<span class="string">"@load(vm.name)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">value</span>=<span class="string">"@load(vm.address.street)"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>vm.address</code> 是一个JavaBean, 所以我们可以使用EL表达式访问它的street属性，如 <code>vm.address.street</code> (第5行)</p>
</blockquote>
<h3 id="集合类型属性"><a href="#集合类型属性" class="headerlink" title="集合类型属性"></a>集合类型属性</h3><p>如果UI组件是诸如列表框或网格之类的集合容器，则应将其绑定到类型为map或集合的子接口（例如List或Set）的属性。</p>
<h4 id="集合类型属性-1"><a href="#集合类型属性-1" class="headerlink" title="集合类型属性"></a>集合类型属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">//primitive type</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> selectedIndex;</span><br><span class="line">    <span class="comment">//Collection</span></span><br><span class="line">    <span class="keyword">private</span> List itemList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSelectedIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> selectedIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSelectedIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        selectedIndex = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* As we can't save whole list through data binding, the ViewModel only provides getter for itemList.*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getItemList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itemList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用CollectionViewModel的zul"><a href="#使用CollectionViewModel的zul" class="headerlink" title="使用CollectionViewModel的zul"></a>使用CollectionViewModel的zul</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">value</span>=<span class="string">"@load(vm.address.street)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listbox</span> <span class="attr">model</span>=<span class="string">"@load(vm.itemList)"</span> <span class="attr">selectedIndex</span>=<span class="string">"@bind(vm.selectedIndex)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">"model"</span> <span class="attr">var</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listitem</span> <span class="attr">label</span>=<span class="string">"@load(item.name)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listbox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>第二行: Listbox的 model 属性被绑定到一个 集合对象 <code>vm.itemList</code></p>
</blockquote>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>ViewModel是View的抽象。 View负责显示信息并与用户进行交互。 该信息对应于ViewModel的属性，而交互对应于ViewModel的Command。 Command是操纵ViewModel属性的动作。 每个命令都提供了View可以在ViewModel上执行的操作。 这些操作也是用户与View进行交互的方式。 例如，一个ViewModel提供2个命令：“保存”和“删除”。 这意味着用户只能使用ViewModel在View上执行这两个操作。 他们可以通过单击按钮或菜单项来执行操作。</p>
<p>由于ViewModel的角色类似于Controller，开发人员可以通过指定Command的名称来将UI组件的事件绑定到Command，该名称类似于注册事件侦听器。 多个事件可以绑定到同一命令。 当用户与组件交互时（例如，单击按钮），该组件会触发一个事件，然后数据绑定机制将触发Command的执行。 该命令可以修改ViewModel的属性，然后显示在View上的信息会更改。</p>
<p>![image-20200605160053850](/Users/lhj/Library/Mobile Documents/com<del>apple</del>CloudDocs/md/ZK/ZK-MVVM-02-ViewModel.assets/image-20200605160053850.png)</p>
<p>Command作为ViewModel的方法实现。 因为ViewModel是POJO，所以为了使数据绑定机制标识哪个方法表示Command，开发人员必须使用ZK提供的@command注解对方法进行注解。 在下一节中，我们将使用术语：Command方法来描述ViewModel的特殊注解方法。 这些方法通常会操纵ViewModel的属性，例如删除项目。 触发组件的事件将触发绑定命令的执行，即调用Command方法。 在执行命令期间，开发人员还必须指定要更改的属性以通过Java注解进行通知，我们将在后面的部分中进行描述。</p>
<h3 id="声明Commands"><a href="#声明Commands" class="headerlink" title="声明Commands"></a>声明Commands</h3><h4 id="本地Command"><a href="#本地Command" class="headerlink" title="本地Command"></a>本地Command</h4><p>ViewModel的Command类似于事件处理程序，我们可以将事件绑定到Command。 事件和command之间的绑定就是我们所说的“Event-Command Binding”。 建立此绑定之前，我们必须在ViewModel中声明其名称的Command。 请注意，ViewModel中的命令名称不能重复，否则会导致运行时异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderVM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create and add a new order to a list</span></span><br><span class="line">    <span class="comment">// command name is set to method name by default</span></span><br><span class="line">    <span class="comment">/* Notice that we can declare a Command without specifying its name, and its name is set to method name by default. */</span></span><br><span class="line">    <span class="meta">@Command</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Order order = <span class="keyword">new</span> Order();</span><br><span class="line">        getOrders().add(order); <span class="comment">//add a new order to order list selected = order;//select the new one</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save an order</span></span><br><span class="line">    <span class="comment">// command name is specified</span></span><br><span class="line">    <span class="comment">/* We can also give Command's name by @Command('userDefinedName'). */</span></span><br><span class="line">    <span class="meta">@Command</span>(<span class="string">"save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderService.save(selected);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete an order</span></span><br><span class="line">    <span class="comment">// multiple command names</span></span><br><span class="line">    <span class="comment">/* We can even give multiple Command's name with array of String. */</span></span><br><span class="line">    <span class="meta">@Command</span>(&#123;<span class="string">"delete"</span>, <span class="string">"deleteOrder"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//delete order</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们可以在ZUL中把组件的事件绑定到command</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">toolbar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">label</span>=<span class="string">"New"</span> <span class="attr">onClick</span>=<span class="string">"@command('newOrder')"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">label</span>=<span class="string">"Save"</span> <span class="attr">onClick</span>=<span class="string">"@command('save')"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们将在 <a href="#_bookmark16">command binding here</a> 描述command绑定细节，绑定允许您将参数传递给Command方法，请参阅 <a href="#_bookmark32">here</a>.</p>
</blockquote>
<h4 id="全局Command"><a href="#全局Command" class="headerlink" title="全局Command"></a>全局Command</h4><p>全局Command也是ViewModel的command，可以将UI组件的事件绑定到它。 只能通过ViewModel的Root View组件及其子组件的事件来触发本地Command。 全局Command可以由任何ZUL中的组件事件触发。 全局Command与本地Command的主要区别在于事件不必属于ViewModel的根视图组件或其子组件。 默认情况下，我们可以将事件绑定到同一桌面上的任何ViewModel的全局Command。 方法既可以是本地Command，也可以是全局Command。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Command</span>(<span class="string">"delete"</span>)</span><br><span class="line"><span class="meta">@GlobalCommand</span>(<span class="string">"delete"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以在不同的ViewModel中声明多个具有相同名称的全局Command。 当事件触发全局命令时，将执行每个ViewModel中所有匹配的Command方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GlobalCommand</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GlobalCommand</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果触发全局Command “<code>show</code>“，则与每个ViewModel关联的每个binder将执行show 全局Command方法，但<code>不按任何特定顺序</code>执行。</p>
</blockquote>
<h3 id="Command执行"><a href="#Command执行" class="headerlink" title="Command执行"></a>Command执行</h3><p>Command执行是ZK Bind的一种机制，它在ViewModel上执行方法调用。 它绑定到组件的事件，并且当绑定事件到来时，绑定程序将遵循生命周期来完成执行。 我们将在 <a href="#_bookmark16">Command Binding </a>和 <a href="#_bookmark27">Global Command Binding</a>中对此进行详细描述。</p>
<h2 id="通知（Notification）"><a href="#通知（Notification）" class="headerlink" title="通知（Notification）"></a>通知（Notification）</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>binder负责在View和ViewModel之间同步数据。 通常，ViewModel是POJO，并且不引用任何UI组件。 因此，它无法将数据推送到UI组件。 开发人员必须使用ZK提供的Java注解指定ViewModel属性的依赖关系，然后binder知道何时重新加载哪个属性和更新UI视图</p>
<h3 id="Notify-Change"><a href="#Notify-Change" class="headerlink" title="Notify Change"></a>Notify Change</h3><p>ZK绑定提供了一组Java注解（@NotifyChange，@DependsOn，@NotifyChangeDisabled），用于指定何时将哪个属性重新加载到UI组件。 开发人员必须在设计时指定它，binder将在运行时同步数据。 binder跟踪组件的属性和ViewModel的属性之间的绑定关系。 每次调用ViewModel的方法（setter，getter或command方法）后，它都会根据注解中指定的属性寻找要重新加载的相应组件属性。</p>
<h4 id="在Command通知（Notify-on-Command）"><a href="#在Command通知（Notify-on-Command）" class="headerlink" title="在Command通知（Notify on Command）"></a>在Command通知（Notify on Command）</h4><p>在执行command期间，一个或多个属性会更改，因为Command方法通常包含业务或表示逻辑。 开发人员必须在Java注解的元素中指定要更改的一个或多个属性，然后数据绑定机制可以在执行Command后在运行时将它们从ViewModel重新加载到View。</p>
<p>通知属性更改的语法：</p>
<p>一个属性：                             @NotifyChange(“oneProperty”)</p>
<p>多个属性:                                @NotifyChange({“property01”,”property02”}) </p>
<p>ViewModel的所有属性:       @NotifyChange(“*“)</p>
<p>例子： @NotifyChange :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderVM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//the order list </span></span><br><span class="line">    List&lt;Order&gt; orders;</span><br><span class="line">    <span class="comment">//the selected order </span></span><br><span class="line">    Order selected;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getter and setter</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotifyChange</span>(<span class="string">"selected"</span>)</span><br><span class="line">    <span class="meta">@Command</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        getService().save(selected);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* In newOrder() , we change property "orders" and "selected",</span></span><br><span class="line"><span class="comment">    therefore we apply @NotifyChange to notify binder to reload 2 changed properties after command execution. */</span></span><br><span class="line">    <span class="meta">@NotifyChange</span>(&#123;<span class="string">"orders"</span>, <span class="string">"selected"</span>&#125;)</span><br><span class="line">    <span class="meta">@Command</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Order order = <span class="keyword">new</span> Order();</span><br><span class="line">        getOrders().add(order);</span><br><span class="line">        selected = order;<span class="comment">//select the new one</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The deleteOrder() also change the same 2 properties. Assume that this ViewModel class has only 2 properties,</span></span><br><span class="line"><span class="comment">    we can use "*" (asterisk sign) to notify all properties in current class. */</span></span><br><span class="line">    <span class="meta">@NotifyChange</span>(<span class="string">"*"</span>)</span><br><span class="line">    <span class="meta">@Command</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        getService().delete(selected);<span class="comment">//delete selected getOrders().remove(selected);</span></span><br><span class="line">        selected = <span class="keyword">null</span>; <span class="comment">//clean the selected</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Notify-on-Setter"><a href="#Notify-on-Setter" class="headerlink" title="Notify on Setter"></a>Notify on Setter</h4><p>由于类似的原因，属性可能会在setter方法中更改。 将值保存到ViewModel的属性后，多个组件或其他属性可能取决于更改的属性。 我们还必须通过@NotifyChange指定此数据依赖项。</p>
<h4 id="默认启用（Enabled-by-Default）"><a href="#默认启用（Enabled-by-Default）" class="headerlink" title="默认启用（Enabled by Default）"></a>默认启用（Enabled by Default）</h4><p>setter方法通常仅更改一个属性，例如 setMessage()将message设置为新值。 为了节省开发人员的工作量，将自动通知通过setter方法更改的目标属性。 也就是说，除非在setter上更改了某些其他属性并且需要显式通知，否则在setter上不需要@NotifyChange注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        message = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果在setter方法中仅更改了message，则无需在MessageViewModel中的setMessage()上指定@NotifyChange</p>
</blockquote>
<p><strong>使用MessageViewModel的zul</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textbox</span> <span class="attr">id</span>=<span class="string">"msgBox"</span> <span class="attr">value</span>=<span class="string">"@bind(vm.message)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">id</span>=<span class="string">"msg1"</span> <span class="attr">value</span>=<span class="string">"@load(vm.message)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">id</span>=<span class="string">"msg2"</span> <span class="attr">value</span>=<span class="string">"@load(vm.message)"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>当用户在msgBox中输入值并将该值保存回ViewModel时，数据绑定机制将自动将该值同步到msg1和msg2。</p>
<blockquote>
<p>开发人员可以通过在setter方法上添加@NotifyChangeDisabled来禁用此默认行为。</p>
</blockquote>
<h4 id="指定依赖关系（Specify-Dependency）"><a href="#指定依赖关系（Specify-Dependency）" class="headerlink" title="指定依赖关系（Specify Dependency）"></a>指定依赖关系（Specify Dependency）</h4><p>对于setter方法，当多个属性具有依赖关系时,使用@NotifyChange,例如 一个属性的值是从其他属性计算得出的。 请注意，如果在setter方法上应用@NotifyChange，则默认通知行为将被覆盖。</p>
<p><strong>@NotifyChange on Setter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FullnameViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">//getter and setter @NotifyChange("fullname")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstname</span><span class="params">(String firstname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstname = firstname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* By default setLastname() will notify "lastname" property's change. Becuase we apply NotifyChange on it, this default notification is overridden.</span></span><br><span class="line"><span class="comment">    We have to notify it explicitly. */</span></span><br><span class="line">    <span class="meta">@NotifyChange</span>(&#123;<span class="string">"lastname"</span>, <span class="string">"fullname"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastname</span><span class="params">(String lastname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastname = lastname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFullname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (firstname == <span class="keyword">null</span> ? <span class="string">""</span> : firstname) + <span class="string">" "</span></span><br><span class="line">                + (lastname == <span class="keyword">null</span> ? <span class="string">""</span> : lastname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的代码段中，全名由名和姓连接在一起。 通过设置程序更改名字和姓氏时，应重新加载全名以反映其更改。</p>
<p>如果一个属性依赖于许多属性，则@NotifyChange将分布在ViewModel类的多个位置。 为了方便起见，开发人员可以使用@DependsOn。 该注解定义了属性之间的依赖关系，可以提供与显式@NotifyChange相同的功能，但它用于getter方法。</p>
<h4 id="DependsOn例子"><a href="#DependsOn例子" class="headerlink" title="@DependsOn例子"></a>@DependsOn例子</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FullnameViewModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getter and setter</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstname</span><span class="params">(String firstname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstname = firstname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastname</span><span class="params">(String lastname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastname = lastname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The example is functional equivalent to previous one, but written in</span></span><br><span class="line"><span class="comment">    reversed meaning. It means when any one of 2 properties (firstname, lastname) change, fullname should be reloaded. */</span></span><br><span class="line">    <span class="meta">@DependsOn</span>(&#123;<span class="string">"firstname"</span>, <span class="string">"lastname"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFullname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (firstname == <span class="keyword">null</span> ? <span class="string">""</span> : firstname) + <span class="string">" "</span></span><br><span class="line">                + (lastname == <span class="keyword">null</span> ? <span class="string">""</span> : lastname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通知Bean变更（Notify-Bean-Change）"><a href="#通知Bean变更（Notify-Bean-Change）" class="headerlink" title="通知Bean变更（Notify Bean Change）"></a>通知Bean变更（Notify Bean Change）</h3><p>如果将组件的属性绑定到Bean，并希望在Bean的属性更改后重新加载它，则应在目标属性的setter上应用以下语法：</p>
<h4 id="NotifyChange-“-”"><a href="#NotifyChange-“-”" class="headerlink" title="@NotifyChange(“.”)"></a>@NotifyChange(“.”)</h4><p>请注意，点(.)与星号(<em>)有点不同，因为星号@NotifyChange(“</em>”)仅通知binder重新加载绑定到bean属性的那些组件，例如 @bind(vm.person.firstname)，@bind(vm.person.lastname)和@bind(vm.person.fullname)。 与Bean本身绑定的component属性（即vm.person）将不会使用@NotifyChange(“*”)重新加载。 在这种情况下，您必须使用@NotifyChange(“.”)来告诉binder该bean本身已经更改，并且绑定到该bean的component属性必须重新加载。</p>
<p>对于哪些用例，您将需要此功能？ 大多数时候，我们将一个组件属性绑定到一个bean属性。 但是，在某些情况下，您可能希望将component属性绑定到多个Bean属性的计算结果。 但是您不想将计算逻辑放入bean中。 然后，您可以将component属性绑定到整个bean，并具有一个转换器，用于根据bean的多个属性来转换数据。</p>
<p>例如，假设旅游网站中有一个网页。 客户必须填写旅行的休假日和返回日，并且旅行时间将自动计算并在用户填写两个字段后显示在屏幕上。 在这里，我们选择使用转换器来进行持续时间计算，而不是将Trip类中的逻辑实现为属性。 在这种情况下，您将需要在LeaveDate和returnDate属性设置器上添加@NotifyChange(“.”)注解，以便当LeaveDate或returnDate属性更改时，可以更新duration属性。</p>
<h4 id="绑定到对象示例"><a href="#绑定到对象示例" class="headerlink" title="绑定到对象示例"></a>绑定到对象示例</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hlayout</span>&gt;</span></span><br><span class="line">    Leave Date:<span class="tag">&lt;<span class="name">datebox</span> <span class="attr">value</span>=<span class="string">"@save(vm.trip.leaveDate)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hlayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hlayout</span>&gt;</span></span><br><span class="line">    Return Date:<span class="tag">&lt;<span class="name">datebox</span> <span class="attr">value</span>=<span class="string">"@save(vm.trip.returnDate)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hlayout</span>&gt;</span></span><br><span class="line">Duration including leave and return(day): <span class="tag">&lt;<span class="name">label</span> <span class="attr">value</span>=<span class="string">"@load(vm.trip) @converter(vm.durationConverter)"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为durationConverter需要访问2个属性（leaveDate，returnDate），所以我们必须将标签的值绑定到旅行bean本身，而不是bean的单个属性。</p>
</blockquote>
<h4 id="NotifyChange-“-”-例子"><a href="#NotifyChange-“-”-例子" class="headerlink" title="@NotifyChange(“.”) 例子"></a>@NotifyChange(“.”) 例子</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DurationViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Trip trip = <span class="keyword">new</span> Trip();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trip</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Date leaveDate;</span><br><span class="line">        <span class="keyword">private</span> Date returnDate;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getLeaveDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> leaveDate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotifyChange</span>(<span class="string">"."</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaveDate</span><span class="params">(Date leaveDate)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getReturnDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> returnDate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotifyChange</span>(<span class="string">"."</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReturnDate</span><span class="params">(Date returnDate)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.returnDate = returnDate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Converter <span class="title">getDurationConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Converter() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">coerceToUi</span><span class="params">(Object val, Component component, BindContext ctx)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (val <span class="keyword">instanceof</span> Trip) &#123;</span><br><span class="line">                    Trip trip = (Trip) val;</span><br><span class="line">                    Date leaveDate = trip.getLeaveDate();</span><br><span class="line">                    Date returnDate = trip.getReturnDate();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> != leaveDate &amp;&amp; <span class="keyword">null</span> != returnDate) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (returnDate.compareTo(leaveDate) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (returnDate.compareTo(leaveDate) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> ((returnDate.getTime() - leaveDate.getTime()) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>) + <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">coerceToBean</span><span class="params">(Object val, Component component, BindContext ctx)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于如何实现转换器，请参阅  <a href="#_bookmark23">Data Binding/Converter</a></p>
</blockquote>
<h3 id="以编程方式通知（Notify-Programmatically）"><a href="#以编程方式通知（Notify-Programmatically）" class="headerlink" title="以编程方式通知（Notify Programmatically）"></a>以编程方式通知（Notify Programmatically）</h3><p>有时，我们要通知的已更改属性取决于运行时的值，因此我们无法在设计时确定属性的名称。 在这种情况下，我们可以使用 <code>BindUtils.postNotifyChange(String queueName, String queueScope, Object bean, String property))</code> 动态通知更改。 此通知的基本机制是我们在<a href="#_bookmark14">the binder section</a>部分讨论的binder订阅事件队列。 默认情况下，它使用<code>desktop scope</code>事件队列。</p>
<h4 id="动态通知（Dynamic-Notification）"><a href="#动态通知（Dynamic-Notification）" class="headerlink" title="动态通知（Dynamic Notification）"></a>动态通知（Dynamic Notification）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String data;</span><br><span class="line"><span class="comment">// setter &amp; getter</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Command</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cmd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (data.equal(<span class="string">"A"</span>)) &#123;</span><br><span class="line">        <span class="comment">//other codes... </span></span><br><span class="line">        BindUtils.postNotifyChange(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">this</span>,<span class="string">"value1"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//other codes... </span></span><br><span class="line">        BindUtils.postNotifyChange(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">this</span>,<span class="string">"value2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postNotifyChange()的第一个参数是队列名称，第二个参数是队列作用域。 您可以将其保留为空，并且将使用默认队列名称和范围（桌面）。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/07/zk-mvvm-01-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeeHuaJun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/leehuajun/imgbed/raw/master/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeHuaJun's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/07/zk-mvvm-01-introduction/" itemprop="url">ZK-MVVM-01-Introduction</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-07T18:04:54+08:00">
                2020-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zk/" itemprop="url" rel="index">
                    <span itemprop="name">zk</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h2 id="MVVM简介"><a href="#MVVM简介" class="headerlink" title="MVVM简介"></a>MVVM简介</h2><p>MVVM [1]是源自Microsoft的设计模式Model-View-ViewModel的缩写。[2] 它是由著名的MVC模式的变体Martin Fowler引入的Presentation Model [3]的一种特殊化。 此模式具有3个角色：View，Model和ViewModel。 View 和 Model 起着与MVC中相同的作用。</p>
<p>MVVM中的ViewModel就像View的特殊控制器一样，负责将Model中的数据公开到View，并为View的用户请求提供所需的操作和逻辑。 ViewModel是View抽象的类型，其中包含View的状态和行为。 但是ViewModel应该不包含对UI组件的引用，并且对View的可视元素一无所知。 因此，View和ViewModel之间有明显的分隔，这也是MVVM模式的关键特征。 从另一个角度讲，也可以说View层就像ViewModel的UI投影。</p>
<blockquote>
<p>[1] : WPF Apps With The Model-View-ViewModel Design Pattern <a href="http://msdn.microsoft.com/en-us/magazine/dd419663.aspx" target="_blank" rel="noopener">http://msdn.microsoft.com/en-us/magazine/dd419663.aspx</a><br>[2] : Introduction to Model/View/ViewModel pattern for building WPF apps <a href="http://blogs.msdn.com/b/johngossman/archive/2005/10/08/478683.aspx" target="_blank" rel="noopener">http://blogs.msdn.com/b/johngossman/archive/2005/10/08/478683.aspx</a><br>[3] : Presentation Model <a href="http://martinfowler.com/eaaDev/PresentationModel.html" target="_blank" rel="noopener">http://martinfowler.com/eaaDev/PresentationModel.html</a></p>
</blockquote>
<h2 id="MVVM的优势"><a href="#MVVM的优势" class="headerlink" title="MVVM的优势"></a>MVVM的优势</h2><blockquote>
<p>将数据和逻辑与表示分离</p>
</blockquote>
<p>关键特性是ViewModel对View的可视元素一无所知，从而保证了从View到ViewModel的单向依赖，从而避免了UI和ViewModel之间的相互编程涟漪效应。 因此，它具有以下优点：</p>
<ul>
<li>它适合<code>design-by-contract</code>编程。[1] 只要制定好约定（contract）（显示哪些数据以及执行什么操作），ViewModel的UI设计和编码就可以并行且独立地进行。 任何一方都不会阻碍对方的前进。</li>
<li>与View的松耦合。 只要不更改约定（contract），就可以不经修改就轻松地随时更改UI设计，而无需修改ViewModel。</li>
<li>更好的可重用性。 使用通用的ViewModel为不同的设备设计不同的视图会更加容易。 对于具有更大屏幕的桌面浏览器，可以在一页上显示更多信息。 而对于显示空间有限的智能手机，无需更改（大部分）ViewModel，就可以设计基于向导的逐步操作UI。</li>
<li>更好的可测试性。 由于ViewModel不能“看到”表示层，因此开发人员可以在没有UI元素的情况下轻松地对ViewModel类进行单元测试。</li>
</ul>
<p>[1] : Design by contract <a href="http://en.wikipedia.org/wiki/Design_by_contract" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Design_by_contract</a></p>
<h2 id="MVVM-amp-ZK-Bind"><a href="#MVVM-amp-ZK-Bind" class="headerlink" title="MVVM &amp; ZK Bind"></a>MVVM &amp; ZK Bind</h2><p>由于ViewModel不包含对UI组件的引用，因此需要一种在View和ViewModel之间同步数据的机制。 此外，此机制还必须接受来自View层的用户请求，并将该请求桥接到ViewModel层提供的动作和逻辑。 这种机制是MVVM设计模式的核心部分，它要么是由应用程序开发人员自己编写的数据同步代码，要么是框架提供的数据绑定系统。 ZK 6提供了一种称为ZK Bind的数据绑定机制，作为MVVM设计模式的基础架构，而binder [1]在操作整个机制中起着关键作用。 绑定器就像一个代理，负责View和ViewModel之间的通信。</p>
<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607180539.png" alt="image-20200605153832368"></p>
<blockquote>
<p>[1] : binder ZK Developer’s <a href="#_bookmark14">DataBinding/Binder</a></p>
</blockquote>
<h2 id="详细操作流程"><a href="#详细操作流程" class="headerlink" title="详细操作流程"></a>详细操作流程</h2><p>在这里，我们使用一个简单的场景来说明MVVM如何在ZK中工作。 假定用户单击一个按钮，然后出现“ Hello World”文本。 流程如下：</p>
<p><img src="https://gitee.com/leehuajun/imgbed/raw/master/2020/20200607161819.png" alt="image-20200605153922498"></p>
<p>如前所述，绑定程序在UI和ViewModel之间同步数据。</p>
<ol>
<li>用户按下屏幕上的按钮（执行操作）。</li>
<li>一个相应的事件被激发到binder。</li>
<li>binder在ViewModel中找到相应的动作逻辑（它是Command）并执行它。</li>
<li>动作逻辑从模型层访问数据并更新ViewModel的相应属性。</li>
<li>ViewModel通知binder某些属性已更改。</li>
<li>根据已更改的属性，binder从ViewModel加载数据。</li>
<li>Binder然后更新相应的UI组件以向用户提供视觉反馈。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://gitee.com/leehuajun/imgbed/raw/master/photo.jpg"
                alt="LeeHuaJun" />
            
              <p class="site-author-name" itemprop="name">LeeHuaJun</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/leehuajun" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lhj2020@aliyun.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">leehuajun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
